
# 하청 공급망 네트워크 분석 프로젝트

## 1. 프로젝트 소개


### 기술 스택
- **Languages & Tools** : R (4.0+), STATA (17+)
- **Network Analysis**
	- igraph: 네트워크 구조 분석 및 그래프 알고리즘
	- Network Metrics: PageRank, Degree Centrality, 거리 행렬
- **Data Processing** :   dplyr, tidyverse
- **Visualization** : ggplot2, ggraph

### 개요

사회 연결망 분석 방법론을 적용해 한국평가데이터(KoDATA)의 국내 기업 간 거래 자료를 분석하고, 하청 공급망 내 계층(tier)을 할당하는 방법을 다룹니다.  


### 왜 이 분석을 해야하나요?

- 한국 경제는 대기업과 하청기업 간의 뚜렷한 **위계적 구조**가 특징
	- 소수의 대기업이 다수의 중소기업과 거래하는 수직적 구조 고착화
	- 대기업-중소기업 간 임금, 생산성, 수익성 격차 지속 확대
	- 이러한 구조적 특성이 한국 경제의 양극화에 기여한다는 지적
- **단순한 매출 규모나 산업 분류로는 이러한 기업 간 관계의 복잡성을 포착하기 어려움**
	- 공급망 내 위치에 따라 협상력과 거래조건이 달라질 수 있음 (Kranton and Minehart ,2001)
	- 위계 구조가 기업의 임금, 고용 등 기업의 주요 의사결정에 미치는 영향을 분석하기 위해서는 공급망 내 기업의 정확한 차수 식별이 필수(Hong and Jung, 2015)
- 특히, 최근의 실증 연구들은 **우리의 직관과 실제 데이터 간에 상당한 괴리**가 있음을 보여줌 
	- 도요타 공급망 분석에서 피라미드형이 아닌 항아리형 구조 발견(Nakano and White, 2007)
	- 단순한 수직적 구조가 아닌 복잡한 네트워크 구조의 존재 확인
	- 직관 대신 데이터 기반 접근의 필요성

### 사회 연결망 분석이 필요한 이유 

사회 연결망 분석은 다음 이유에서 기업 간 거래 관계 연구에 특히 적합합니다. 

- **중심 행위자의 식별**이 SNA 방법론의 핵심 목적
	- 행위자들 간의 관계적 속성에 초점 예) 연결 강도, 연결 방향 ...
	- 네트워크 내 영향력 구조 파악을 위한 다양한 도구 제공
- **구조적 위치가 행위자의 기회와 제약을 결정**한다는 전제
	- 방향이 있는 위계 구조를 명시적으로 고려하고 분석할 수 있음
- 결국, 원청-하청 구조 식별에 의한 기업 생태계 분석에 가장 적합한 방법론

## 2. 분석 로드맵

### 아이디어와 해결 과제

분석의 기본 아이디어는 전체 공급망에서 최상위 계층에 있는 기함 기업 (flagship enterprise)을 찾아내고, 그 기업들로부터의 네트워크 거리를 기준으로 나머지 기업들에 공급 차수를 차례로 부여하는 것입니다. 

그러나 이러한 아이디어의 실행에는 몇 가지 기술적 과제가 있습니다. 

- 첫째, **거래 데이터의 비대칭성**입니다. 상대적으로 '갑'의 위치에 있는 구매측의 거래 데이터는 '을'의 위치에 있는 판매측 거래 데이터와 비교했을 때 누락이 많습니다. 이러한 비대칭성을 무시하면 네트워크 데이터의 선택 편향이 커질 수 있습니다. 따라서 본격적인 분석 이전에 섬세한 데이터 전처리 과정이 요구됩니다. 
- 둘째, **기함 기업 식별**의 기준입니다. 기함 기업으로부터 나머지 공급차수 기업이 뻗어 나오기 때문에, 타당한 기함 기업 목록을 작성하는 것이 가장 중요합니다. 매출 등의 기업 규모와 네트워크 영향력은 비슷해 보이지만 실제 데이터에서는 차이가 있습니다. 특히, 한쪽 기준에 의존해 기함 기업을 선정하게 되면 우리가 생각하는 "기함 기업"에서 크게 멀어지게 됩니다. 
- 셋째, **계층 할당 로직**입니다. 단순히 기함 기업과의 거리로 계층을 할당하게 되면 규모가 작은 기업이나 일회성의 거래도 똑같이 상위 계층에 할당하는 문제가 발생합니다.  본 연구에서는 이러한 부적합한 계층 할당 문제를 해결하기 위한 최신 네트워크 분석 논의를 참조합니다. 

###  전체 분석 플로우 

분석은 크게 3단계로 이루어집니다. 

- 먼저, 비대칭성이 있는 거래 데이터를 보완합니다. 이를 위해 자료 결측 유형을 세 종류로 세분화하여 각각에 대한 처리를 진행한 뒤, 정상 데이터에 다시 이어 붙이는(append)하는 방식으로 보완합니다. 이 과정은 매출, 종업원수 등 규모 데이터의 보완이나 레이블의 매끄러운 통합도 포함합니다. 자세한 사항은 문서 [1-kodata-cleansing]에서 확인하세요. 
- 그 다음, 네트워크 영향력 지수인 PageRank와 매출 순위 자료를 함께 활용해 기함 기업 목록을 작성합니다. 이를 위해 두 순위를 조건부 방식으로 조합한 뒤 기하 평균으로 정렬할 것입니다. 더 자세한 내용은 문서 [2-flagship-firm-identification] 에서 확인하세요. 
- 마지막으로, 타당한 1차 협력사를 식별하기 위해 규모 기반 접근(홍장표, 2015)에 기반한 초기 계층화를 수행한 뒤,  네트워크 구조(Gofman and Wu, 2022; Nakano and White, 2007)에 대한 고려를 명시적으로 통합한 동적 조정을 반복해 계층 할당의 타당성을 높입니다. 이 과정에서 상당수의 기업이 체계적인 기준에 따라 여러 번 계층 간 이동을 하는 모습을 확인할 수 있습니다. 자세한 내용은 문서 [3-tier-identification] 에서 확인하세요. 

1. **데이터 준비 :** KoDATA의 기업 간 거래 데이터 클렌징
2. **기함 기업 목록 만들기:** 
	1. PageRank : 위계를 어느 정도 고려할 수 있음. 영향력에 초점
	2. 매출 순위 : 직관적인 순위가 나오지만 공급망 내에서의 관계를 고려하지 않음
	3. Bonacich Power Centrality : 권력 관계를 명시적으로 모델링 (추후 보완)
3. **공급 차수 식별 :** 기함기업 목록을 이용한 공급망 내  차수 식별
	1. **단순 네트워크 거리 측정 :** 1차 협력사를 기함 기업과 가장 가까운 기업으로 정의
	2. **규모 기반 접근 (홍장표 2015)** : 기업 규모 고려해 1차 협력사 선별
	3. *정교화된 네트워크 측정 통합 
		1. 네트워크 위계성 Upstreamness (Gofman and Wu, 2022) 
		2. 네트워크 응집성 Cohesive Sequence Levels; CoSL (Nakano and White, 2007)
	4. **앙상블  접근**
		1. 홍장표 (2015) 아이디어를 따라 초기 계층화 수행 
		2. in/out 비율,  Upstreamness 및 CoSL 기준을 통합한 동적 조정 반복

## 3. 데이터 처리 및 분석

### 3.1 한국평가데이터(KoDATA) 기업 간 거래 데이터 전처리

#### 원본 데이터가 가진 주요 문제점과 해결 방안:
   - 구매처/판매처 보고 정보의 비대칭성 존재
   - 특히 거래처의 식별코드인 KEDCD_TRD의 누락 문제 예) '미상', '자료 제시 거부로 미기재' 등
   - 거래 관계 상호 매칭을 통한 데이터 보완     
#### 보완 결과 : 

| 구분               | 빈도        | 비율    |
| ---------------- | --------- | ----- |
| 1. 정상 거래쌍        | 587,470   | 50.8  |
| 2. 표본에서 누락되었던 기업 | 566,202   | 48.96 |
| 3. 구매측에 판매측 행 추가 | 233       | 0.02  |
| 4. 자료 미기재        | 2,608     | 0.23  |
| Total            | 1,156,513 | 100   |
- (1) : 보완이 필요 없는 정상 거래 자료
- (2) + (3) : 판매측에서 보고하였으나 구매측이 누락한 거래 자료로, 매칭으로 생성하여 보완 
- (4) : 구매측이 기존에 '미상' 등으로 보고한 자료로, (2)와 (3)으로 대체하고 남은 관측치. 생성 관측치로 대체되지 않은 '미기재 자료'는 모두 영세 사업체 

- 결과적으로 **48.98%의 자료를 복구**
- 특히, **매출 상위 기업은 모두 보완**

### 3.2 R을 이용한 분석

#### 1. 기함 기업 식별하기
- **최상위 계층 기업 선별 방법**  :
	1. PageRank를 이용해 영향력 상위 기업 리스트 추출
	2. 매출 순위와 영향력 순위 조합으로 타당한 기함기업 리스트 확정
- **기함기업 리스트(가나다 순) :** 

|              |               |                  |                |
| ------------ | ------------- | ---------------- | -------------- |
| "(주)국민은행"    | "(주)포스코건설"    | "삼성엔지니어링(주)"     | "지에스칼텍스(주)"    |
| "(주)대우건설"    | "(주)포스코인터내셔널" | "삼성전기(주)"        | "케이지스틸(주)"     |
| "(주)동원홈푸드"   | "(주)한샘"       | "삼성전자(주)"        | "코웨이(주)"       |
| "(주)비지에프리테일" | "(주)한진"       | "삼성중공업(주)"       | "쿠팡(주)"        |
| "(주)서브원"     | "(주)한화"       | "신한카드(주)"        | "포스코홀딩스(주)"    |
| "(주)신세계"     | "(주)현대미포조선"   | "쌍용자동차(주)"       | "한국동서발전(주)"    |
| "(주)신한은행"    | "(주)현대홈쇼핑"    | "씨제이대한통운(주)"     | "한국서부발전(주)"    |
| "(주)씨제이이엔엠"  | "고려아연(주)"     | "씨제이제일제당(주)"     | "한국수력원자력(주)"   |
| "(주)아모레퍼시픽"  | "기아(주)"       | "씨제이프레시웨이(주)"    | "한국전력공사"       |
| "(주)아이마켓코리아" | "네이버(주)"      | "에스케이네트웍스(주)"    | "한국지엠(주)"      |
| "(주)에스원"     | "네이버파이낸셜(주)"  | "에스케이브로드밴드(주)"   | "한화솔루션(주)"     |
| "(주)엘엑스판토스"  | "대상(주)"       | "에스케이에너지(주)"     | "한화토탈에너지스(주)"  |
| "(주)엘엑스하우시스" | "대우조선해양(주)"   | "에스케이에코플랜트(주)"   | "현대건설(주)"      |
| "(주)엘지생활건강"  | "동국제강(주)"     | "에스케이지오센트릭(주)"   | "현대글로비스(주)"    |
| "(주)엘지씨엔에스"  | "두산에너빌리티(주)"  | "에스케이텔레콤(주)"     | "현대두산인프라코어(주)" |
| "(주)엘지유플러스"  | "디엘이앤씨(주)"    | "에스케이하이닉스(주)"    | "현대모비스(주)"     |
| "(주)엘지화학"    | "롯데건설(주)"     | "에쓰대시오일(주)"      | "현대삼호중공업(주)"   |
| "(주)오뚜기"     | "롯데글로벌로지스(주)" | "에이치디씨현대산업개발(주)" | "현대엔지니어링(주)"   |
| "(주)이마트"     | "롯데렌탈(주)"     | "에이치엠엠(주)"       | "현대오일뱅크(주)"    |
| "(주)지에스리테일"  | "롯데쇼핑(주)"     | "엘에스니꼬동제련(주)"    | "현대위아(주)"      |
| "(주)카카오"     | "롯데케미칼(주)"    | "엘에스일렉트릭(주)"     | "현대자동차(주)"     |
| "(주)컬리"      | "삼성디스플레이(주)"  | "엘지디스플레이(주)"     | "현대제철(주)"      |
| "(주)컴퓨존"     | "삼성물산(주)"     | "엘지이노텍(주)"       | "현대중공업(주)"     |
| "(주)케이티"     | "삼성에스디아이(주)"  | "엘지전자(주)"        | "현대캐피탈(주)"     |
| "(주)태영건설"    | "삼성에스디에스(주)"  | "지에스건설(주)"       | "현대트랜시스(주)"    |
#### 2. 협력사 Tier 식별하기
- **앙상블 접근법**
	1. **초기 계층화** : 규모 기반 접근
	2. **순위 조정** (각 계층 내 특정 % 그룹에 적용) : 
		1. 조정 강도 하이퍼 파라미터(0~1)의 하위 파라미터들 :
			1. 구매/판매 비율
			2. 영향력 (PageRank)
			3. 규모 비율 유사도 bottom/top 임계값
			4. 위계성 (Upstreamness)
			5. 응집성 (CoSL)
	3. 결과가 수렴할 때까지 반복 (iteration max<10)

- **식별 결과 요약 통계**
```
=== 앙상블 Tier별 특성 ===
# A tibble: 11 x 6
   ensemble_tier firm_count avg_pagerank avg_degree   avg_sales median_sales
           <dbl>      <int>        <dbl>      <dbl>       <dbl>        <dbl>
 1             0        162   0.0000781      359.   9235664544.  3037614686.
 2             1       7954   0.0000121       33.9   157454430.    24825002.
 3             2      12895   0.00000604      14.1   113713661.    28419815 
 4             3       4781   0.00000603      11.2    38409867.    19720941 
 5             4       1320   0.00000425       6.23   44733136.    20555532.
 6             5        105   0.00000483       6.23   30044968.    17332707 
 7             6         18   0.00000389       6.61   41744951.    17967510 
 8             7          5   0.00000416       6.4    26115821     15799894 
 9             8          1   0.00000940      18       4825000      4825000 
10           Inf        365   0.00000682       9.35   22474507.    14445301 
11            NA     122579   0.00000315       3.51    9448917.     1874965
```
- Tier 에 따라 평균 매출(avg_sales)가 순차적으로 감소
- 항아리형 구조
- Tier 부여가 되지 않은 결측값이 많으나 대리점 또는 규모가 작은 사업장임

## 4. 결론

처음에 제시한 **기술적 과제를 모두 해결**하였습니다. 

1. **거래 데이터의 비대칭성 : 48.99%의 거래쌍 복구**
2. **기함 기업 식별 기준 : 매출 순위와 영향력 순위를 균형 있게 고려**
3. **계층 할당 로직 : 단순 거리 기반 계층화의 한계 극복**
	- 다양한 기업 특성의 종합적 고려
	- 네트워크 응집성(Nakano), 수직적 위계성(Gofman) 통합
	- 동적인 계층 이동성 확보

결과적으로,  실제 기업 간 관계를 더 정확히 반영하는 **현실적인 공급망 구조를 재구성**하였습니다. 

## 참조

- Bonacich, Phillip. 1987. "Power and Centrality: A Family of Measures." American Journal of Sociology 92(5): 1170-1182.
- Brandes, Ulrik. 2001. "A Faster Algorithm for Betweenness Centrality." Journal of Mathematical Sociology 25(2): 163-177.
- Freeman, Linton C. 1979. "Centrality in Social Networks: Conceptual Clarification." Social Networks 1(3): 215-239.
- Gofman, Michael, and Youchang Wu. "Trade credit and profitability in production networks." Journal of Financial Economics 143, no. 2 (2022): 593-618.
- Kranton, Rachel E., and Deborah F. Minehart. "A theory of buyer-seller networks." American Economic Review 91, no. 3 (2001): 485-508.
- Nakano, Tsutomu, and Douglas R. White. "Network structures in industrial pricing: The effect of emergent roles in Tokyo supplier-chain hierarchies." Structure and Dynamics 2, no. 3 (2007).
- White, Harrison C. Markets from networks: Socioeconomic models of production. Princeton University Press, 2002.
- 홍장표, 정재헌. "대기업과 중소기업간 거래네트워크 구조와 특성." 중소기업연구 37, no. 4 (2015): 77-103.